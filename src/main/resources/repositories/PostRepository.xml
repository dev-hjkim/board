<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.post.repository.PostRepository">
    <select id="getTotalCount" parameterType="String" resultType="int">
        SELECT COUNT(board_cd)
          FROM tb_board
         WHERE 1=1
           AND board_cd = #{boardName}
    </select>

    <select id="getPostList" parameterType="Post" resultType="Post">
        SELECT board.board_no
             , board.board_cd
             , board.title
             , board.member_no
             , member.user_id
             , board.view_cnt
             , board.reply_cnt
             , board.reg_dt
             , board.upd_dt
          FROM tb_board board
                JOIN tb_member member
                  ON board.member_no = member.member_no
         WHERE 1=1
           AND board.board_cd = #{boardCd}
         LIMIT #{startPage}, #{pageSize}
    </select>

    <select id="getPost" parameterType="Post" resultType="Post">
        SELECT board.board_no
             , board.title
             , board.content
             , board.member_no
             , member.user_id
             , board.view_cnt
             , board.reply_cnt
             , board.reg_dt
             , board.upd_dt
          FROM tb_board board
                JOIN tb_member member
                  ON board.member_no = member.member_no
        WHERE 1=1
          AND board.board_cd = #{boardCd}
          AND board.board_no = #{boardNo}
    </select>

    <delete id="deletePost" parameterType="Post">
        DELETE FROM tb_board
         WHERE 1=1
           AND board_cd = #{boardCd}
           AND board_no = #{boardNo}
    </delete>

    <insert id="insertPost" parameterType="Post">
        INSERT INTO tb_board (
                               board_cd
                             , title
                             , member_no
                             , content
                             )
                      VALUES (  #{boardCd}
                              , #{title}
                              , #{memberNo}
                              , #{content}
                             )
        <selectKey keyProperty="boardNo,boardCd,title,memberNo,content,viewCnt,replyCnt,regDt,updDt"
                   resultType="Post" order="AFTER">
            SELECT *
              FROM tb_board
             WHERE 1=1
               AND board_no = LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="updatePost" parameterType="Post">
        UPDATE tb_board
           SET title = #{title}
             , content = #{content}
             , upd_dt = now()
         WHERE 1=1
           AND board_cd = #{boardCd}
           AND board_no = #{boardNo}
        <selectKey keyProperty="boardNo,boardCd,title,memberNo,content,viewCnt,replyCnt,regDt,updDt"
                   resultType="Post" order="AFTER">
            SELECT *
              FROM tb_board
             WHERE 1=1
               AND board_no = #{boardNo}
        </selectKey>
    </update>
</mapper>